# OPTIMIZED CONTEXT LOADING - Essential Configuration Only
version: "2.0.0"
strategy: "intelligent_folder_aware"

# CORE: Always load these files
always_load:
  - path: "C:/Users/styry/CLAUDE.md"
    required: true
  - path: "C:/Users/styry/plumber-saas/context/prp-active/*.md"
    required: false
  - path: "C:/Users/styry/plumber-saas/context/specialists/*.md"
    required: true

# SMART: Load based on work area detection
area_detection:
  method: "analyze_user_prompt_and_file_paths"
  
  dashboard:
    keywords: ["dashboard", "jobs", "customers", "invoices", "calendar", "business"]
    folder: "C:/Users/styry/plumber-saas/dashboard/"
    patterns: ["*.md", "*_PATTERNS.md", "*_ARCHITECTURE.md"]
    exclude: ["widget", "ai-core", "marketplace"]
    
  widget:
    keywords: ["widget", "chat", "booking", "conversion", "embedding"]
    folder: "C:/Users/styry/plumber-saas/widget/"
    patterns: ["*.md", "*WIDGET*.md", "*CHAT*.md"]
    exclude: ["dashboard", "ai-core", "marketplace"]
    
  ai_core:
    keywords: ["ai", "gpt", "claude", "prompt", "personality", "voice"]
    folder: "C:/Users/styry/plumber-saas/ai-core/"
    patterns: ["*.md", "*AI*.md", "*PROMPT*.md"]
    exclude: ["dashboard", "widget", "marketplace"]
    
  marketplace:
    keywords: ["marketplace", "overflow", "dispatch", "network"]
    folder: "C:/Users/styry/plumber-saas/marketplace/"
    patterns: ["*.md", "*MARKETPLACE*.md"]
    exclude: ["dashboard", "widget", "ai-core"]

# MCP LATEST VERSION CONFIGURATION (Rule #11: Always Latest Versions)
mcp_latest_docs:
  enabled: true
  always_fetch_current: true
  version_strategy: "never_hardcode_versions"
  libraries:
    nextjs:
      query: "Next.js latest App Router features and patterns"
      avoid_queries: ["Next.js 14", "Next.js 13", "specific version numbers"]
    trpc:
      query: "tRPC latest procedures and best practices"  
      avoid_queries: ["tRPC v10", "specific version numbers"]
    typescript:
      query: "TypeScript latest features and strict mode"
      avoid_queries: ["TypeScript 5.x", "specific version numbers"]
    react:
      query: "React latest hooks and patterns"
      avoid_queries: ["React 18", "React 17", "specific version numbers"]
    prisma:
      query: "Prisma latest ORM features and best practices"
      avoid_queries: ["Prisma 5.x", "Prisma 4.x", "specific version numbers"]
    supabase:
      query: "Supabase latest features and integrations"
      avoid_queries: ["Supabase v2", "specific version numbers"]
    clerk:
      query: "Clerk latest authentication features and patterns"
      avoid_queries: ["Clerk v4", "Clerk v5", "specific version numbers"]
    mollie:
      query: "Mollie latest API features and Dutch payment integration"
      avoid_queries: ["Mollie API v2", "specific version numbers"]
    tailwind:
      query: "Tailwind CSS latest features and utilities"
      avoid_queries: ["Tailwind 3.x", "specific version numbers"]
    schedule_x:
      query: "Schedule-X latest calendar features"
      avoid_queries: ["Schedule-X v2", "specific version numbers"]

# AUTO: File discovery and updates
auto_discovery:
  enabled: true
  scan_frequency: "real_time_when_working_in_area"
  max_files_per_area: 20  # Prevent context overflow
  
  file_update_workflow:
    triggers: ["implementation_success", "new_pattern_detected"]
    phases:
      1: "scan_current_work_area"
      2: "assign_specialists_by_content"
      3: "parallel_updates_with_conflict_detection"
      4: "validate_and_integrate"
    
    specialist_assignment:
      method: "keyword_density_analysis"
      confidence_threshold: 0.75
      max_concurrent_specialists: 3

# PERFORMANCE: Optimization rules with safeguards (PRODUCTION READY)
optimization:
  max_context_size: "75000_tokens"  # Increased for complex multi-area implementations
  compression_strategy: "prioritize_recent_and_relevant"
  cache_duration: "session"
  
  performance_safeguards:
    max_files_per_area: 30  # Increased for mature projects with many patterns
    file_size_limit: "50KB"  # Skip files larger than 50KB
    scan_timeout: "10s"  # Stop scanning after 10 seconds
    memory_usage_limit: "500MB"  # System memory protection
    concurrent_specialist_limit: 3  # Max parallel specialist work
  
  smart_compression:
    trigger_at: "65000_tokens"  # Start compression before limit (87% of max)
    preserve_priority:
      1: "CLAUDE.md master context"
      2: "Current work area files"
      3: "Recently modified files"
      4: "Specialist pattern files"
    compress_strategy: "summarize_older_patterns"
    
  pattern_pruning_automation:
    enabled: true
    triggers:
      pattern_count_threshold: 100  # Auto-prune when >100 patterns per specialist
      similarity_threshold: 0.85  # Merge patterns with >85% similarity
      usage_frequency: "patterns_unused_for_30_days"
      file_age: "patterns_older_than_90_days"
    
    pruning_strategy:
      merge_similar: true  # Combine similar patterns into comprehensive ones
      archive_unused: true  # Move unused patterns to archive folder
      summarize_old: true  # Convert old detailed patterns to summaries
      preserve_successful: true  # Never prune patterns marked as high-success
    
    quality_scoring:
      factors:
        success_rate: 0.4  # 40% weight on implementation success
        usage_frequency: 0.3  # 30% weight on how often used
        dutch_relevance: 0.2  # 20% weight on Netherlands market value
        competitive_advantage: 0.1  # 10% weight on moat building
      
      retention_thresholds:
        keep_forever: 0.9  # Score >0.9 = permanent retention
        regular_cleanup: 0.6  # Score 0.6-0.9 = normal lifecycle
        aggressive_prune: 0.3  # Score <0.3 = candidate for removal
    
    automation_schedule:
      daily: "check_for_duplicate_patterns"
      weekly: "merge_similar_patterns"
      monthly: "comprehensive_pruning_and_archival"
      quarterly: "pattern_quality_reassessment"
  
  emergency_optimizations:
    keywords: ["urgent", "quick", "fast", "asap", "emergency", "deadline"]
    file_limit: 15  # Increased for better emergency context
    specialist_limit: 2  # Only activate top 2 specialists
    analysis_depth: "surface_level"  # Skip deep pattern analysis
    prep_time_target: "<5s"  # 3x faster preparation
    emergency_token_limit: "50000_tokens"  # Still generous for urgent tasks
  
  error_handling:
    file_not_found: "continue_with_warning"
    context_overflow: "compress_older_content_automatically"
    specialist_conflict: "present_options_to_user"
    scan_timeout: "load_cached_file_list"
    memory_limit_reached: "force_compression_and_continue"

# VALIDATION: Success criteria
validation:
  required_context: ["CLAUDE.md", "at_least_one_specialist_pattern"]
  area_isolation: true  # Dashboard work doesn't load widget files
  specialist_activation: "1_to_4_specialists_max"